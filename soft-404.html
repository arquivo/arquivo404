<html>
	<head>
	</head>
	<body>
		Upps!! Not found!

		<a id="onArquivo" style="display: none">
			Nevertheless you still can view a snapshot of this page from on Arquivo.pt
		</a>

		<script>
			/*
			 * Asks Arquivo.pt CDX API what is the latest version of a site URL.
			 * If found any call 
			 */
			function getArquivoLatestVersionOfSite(site, callbackFunction) {
				// ideally make this params configurable
				var server = "https://arquivo.pt";
				//var server = "http://wayback.archive-it.org";
				var path = "/wayback/cdx";
				
				var url = encodeURIComponent(site);
				//var path = "/all/timemap/cdx"
				var params = "?output=json&filter=!~status:4|5&fields=timestamp&limit=1&sort=closest&closest=*&url=" + url;
				var cdxAPIEndpoint = server + path + params;
				var waybackReplayURL = server + "/wayback/";

				var xhttp = new XMLHttpRequest();
				xhttp.onreadystatechange = function() {
				    if (this.readyState == 4 && this.status == 200) {
				    	var responseCDXJ = this.responseText.replace('\n','');
				    	var hasAnyRecord = responseCDXJ.length;
				    	if (hasAnyRecord) {
				    		var fields = JSON.parse(responseCDXJ);
				    		var timestamp = fields.timestamp;
				    		var waybackURL = waybackReplayURL + timestamp + "/" + site;
				    		var timestampAsDate = new Date(
				    			timestamp.substring(0,4),
				    			parseInt(timestamp.substring(4,6))-1,
				    			timestamp.substring(6,8),
				    			timestamp.substring(8,10),
				    			timestamp.substring(10,12),
				    			timestamp.substring(12,14)
				    		);
				    		callbackFunction.call(this, waybackURL, timestampAsDate);
				    	}
				    }
				};
				xhttp.open("GET", cdxAPIEndpoint, true);
				xhttp.send();
			}
			
			// if requesting a 404 HTTP Status and URL requested is maintained then windows.location function.
			//var url = window.location;
			// else write an url to be searched on Arquivo.pt.
			var url = "http://www.fccn.pt";
			getArquivoLatestVersionOfSite(url, function(arquivoptSiteURL, timestamp) {
				console.log(arquivoptSiteURL);
				if (!!arquivoptSiteURL) {
					var onArquivoElement = document.getElementById("onArquivo");
					onArquivoElement.style.display = "block";
					onArquivoElement.href = arquivoptSiteURL;
					onArquivoElement.textContent = "Nevertheless you can still view a snapshot of this page from " + timestamp.toISOString().slice(0,10) + " on Arquivo.pt";
				}
			});

        </script>
	</body>
</html>
