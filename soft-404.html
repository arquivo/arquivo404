<html>
	<head>
	</head>
	<body>
		Upps!! Not found!

		<a id="onArquivo" style="display: none">
			Nevertheless you still can view a snapshot of this page from on Arquivo.pt
		</a>

		<script>
			/*
			 * Asks Arquivo.pt CDX API what is the latest version of a site URL.
			 * If found any call 
			 */
			function getArquivoLatestVersionOfSite(site, callbackFunction) {
				// ideally make this params configurable
				var server = "https://arquivo.pt";
				//var server = "http://wayback.archive-it.org";
				var path = "/wayback/cdx"
				//var path = "/all/timemap/cdx"
				var params = "?fl=timestamp&limit=1&sort=closest&closest=*&url=" + site;
				var cdxAPIEndpoint = server + path + params;
				var waybackReplayURL = server + "/wayback/";

				var xhttp = new XMLHttpRequest();
				xhttp.onreadystatechange = function() {
				    if (this.readyState == 4 && this.status == 200) {
				    	var responseCDX = this.responseText.replace('\n','')
				    	var hasAnyRecord = responseCDX.length
				    	if (hasAnyRecord) {
				    		var spaceIdx = responseCDX.indexOf(' ');
				    		var timestamp = responseCDX.substring(0, spaceIdx);
				    		var waybackURL = waybackReplayURL + timestamp + "/" + site;
				    		var timestampAsDate = new Date(
				    			timestamp.substring(0,4),
				    			parseInt(timestamp.substring(4,6))-1,
				    			timestamp.substring(6,8),
				    			timestamp.substring(8,10),
				    			timestamp.substring(10,12),
				    			timestamp.substring(12,14)
				    		);
				    		callbackFunction.call(this, waybackURL, timestampAsDate);
				    	}
				    }
				};
				xhttp.open("GET", cdxAPIEndpoint, true);
				xhttp.send();
			}
			getArquivoLatestVersionOfSite("http://www.fccn.pt", function(arquivoptSiteURL, timestamp) {
				console.log(arquivoptSiteURL);
				if (!!arquivoptSiteURL) {
					var onArquivoElement = document.getElementById("onArquivo");
					onArquivoElement.style.display = "block";
					onArquivoElement.href = arquivoptSiteURL;
					onArquivoElement.textContent = "Nevertheless you can still view a snapshot of this page from " + timestamp.toISOString().slice(0,10) + " on Arquivo.pt";
				}
			});

        </script>
	</body>
</html>
